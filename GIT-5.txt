This is a file for GIT-5 so that I can put in a PR for you to review. Hope this fixes all the issues.